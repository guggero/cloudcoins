<section>
  <h2 class="section-heading">
    My Keychains <span (click)="helpShown = !helpShown" class="ml-1 fa fa-info-circle"></span>
  </h2>

  <div class="card bg-light mb-4 page-help" *ngIf="helpShown">
    <div class="card-header"><span class="fa fa-info-circle mr-1"></span> Help / Info</div>
    <div class="card-body">
      <p class="card-title">
        A keychain is a set of crypto currency key pairs (private and public keys) that are deterministically calculated
        from a master key (also called the BIP32 master extended key). You can have multiple master keys if you want but
        that is not necessary since you can generate many, many key pairs from one single master key.<br/>
        But if you have a wallet software on your smartphone you might want to import it to Cloudcoins to keep a
        backup.<br/>
        Use the "Add keychain" button to import or generate a master key.
      </p>
    </div>
  </div>

  <div class="row align-items-end mb-4">

    <form class="col-6">
      <div class="form-group" *ngIf="keychains && keychains.length > 0">
        <label for="chain">Select keychain</label>
        <select id="chain"
                name="chain"
                class="form-control"
                [(ngModel)]="selectedChain"
                (change)="selectPosition(selectedChain.positions[0])">
          <option *ngFor="let chain of keychains" [ngValue]="chain">{{chain.name}}</option>
        </select>
      </div>

      <div class="form-group" *ngIf="keychains && keychains.length === 0">
        <span>You don't have any keychains yet.</span>
      </div>
    </form>

    <div class="col-6">
      <div class="form-group">
        <a routerLink="/add-keychain" class="btn btn-primary" role="button">Add keychain</a>
      </div>
    </div>
  </div>

  <div *ngIf="selectedChain !== null">
    <h4>Addresses for keychain {{selectedChain.name}}</h4>
    <nav class="navbar navbar-expand-md navbar-light bg-light position-selection mb-4">
      <span class="navbar-text" *ngIf="!selectedChain.positions || selectedChain.positions.length === 0">
          No coin/crypto currency added yet
      </span>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item" *ngFor="let position of selectedChain.positions">
            <a class="nav-link"
               (click)="selectPosition(position)"
               [class.active]="selectedPosition === position">
              {{position.network.label}}
            </a>
          </li>
        </ul>
        <div class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" data-toggle="dropdown">
            Add coin/crypto currency
          </a>
          <div class="dropdown-menu">
            <a class="dropdown-item" *ngFor="let network of getSelectableNetworks()" (click)="newCoin(network)">
              {{network.label}}
            </a>
          </div>
        </div>
      </div>
    </nav>

    <table class="table mb-4" *ngIf="selectedPosition">
      <thead>
      <tr>
        <th>Address</th>
        <th>Balance</th>
        <th>Private Key</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let pair of selectedPosition.keyPairs">
        <td>{{pair.address}}</td>
        <td>n/a</td>
        <td>{{pair.wif}}</td>
      </tr>
      </tbody>
    </table>

    <button class="btn" *ngIf="selectedNetwork" (click)="newKey(selectedChain)">New key</button>
  </div>
</section>
